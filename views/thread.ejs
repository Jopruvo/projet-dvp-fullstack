<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Thread</title>
</head>


<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<body>

<header>
<a href="http://localhost:3000/accueil">Accueil</a> 
<a href="http://localhost:3000/profil">Profil</a> 
<a href="http://localhost:3000/nouveauThread">Ecrire</a> 
</header>

   <p id="titleThread"></p> 
   <p id="deleteButton"></p> 
   <p id="userThread"></p>
   <p id="contentThread"></p>
   <p id="resultatDeleteThread"></p>


 
</br>
<div>
    
    <br/>
    <label for="reponseCreation">Votre réponse</label>
    <input id="reponseCreation">
</div>
<br/>
<button onclick="createResponse()">Envoyer</button>
<br/>
<br/>
<label>
    Résultat:
</label>
<br/>
<textarea disabled id="resultatCreateResponse" style="width: 500px;height: 100px"></textarea>
<br/>
Réponses :
<br/>
<p id="resultatReadAllResponses"></p>

<hr/>







</body>
</html>

<script>

    recupererTitre();
    recupererAuteur();
    recupererContenu();
    readAllResponse();
    displayDeleteButton();
    deleteThread();

    function deleteThread(){
        axios.delete(`http://localhost:3000/api/thread/${findGetParameter("id")}`).then(function (response) {
            document.getElementById("resultatDeleteThread").innerHTML = response.data
        })
    }

    function recupererTitre() {
        axios.get(`http://localhost:3000/api/thread/${findGetParameter("id")}`).then(function (response) {
            document.getElementById("titleThread").innerHTML = response.data.titre
        })
    }

    function displayDeleteButton() {
        axios.get(`http://localhost:3000/api/deleteButton`).then(function (response) {
            document.getElementById("deleteButton").innerHTML = response.data
        })
    }

    function recupererAuteur() {
        axios.get(`http://localhost:3000/api/thread/${findGetParameter("id")}`).then(function (response) {
            document.getElementById("userThread").innerHTML = "posté par " + response.data.identifiant
        })
    }

    function recupererContenu() {
        axios.get(`http://localhost:3000/api/thread/${findGetParameter("id")}`).then(function (response) {
            document.getElementById("contentThread").innerHTML = response.data.contenu
        })
    }


    function findGetParameter(parameterName) {
        var result = null,
            tmp = [];
        location.search
            .substr(1)
            .split("&")
            .forEach(function (item) {
              tmp = item.split("=");
              if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
            });
        return result;
    }


    function createResponse() {
        
        var contenu = document.getElementById("reponseCreation").value;
        

        axios.post(`http://localhost:3000/api/response/${findGetParameter("id")}`, [contenu]).then(function (response) {
            document.getElementById("resultatCreateResponse").innerHTML = JSON.stringify(response.data);
        }).catch((err) => console.log(err));
        }

    function readAllResponse() {
        axios.get(`http://localhost:3000/api/responses/${findGetParameter("id")}`).then(function (response) {
            document.getElementById("resultatReadAllResponses").innerHTML = response.data;
        })
    }
</script>